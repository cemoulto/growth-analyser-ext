(function(window, document, undefined) {
"use strict";

FusionCharts.register('extension', ['private', 'legend-ext', function () {
  function LegendExt () {
    window.ga = this;
    this.toolbox = FusionCharts.getComponent('api', 'toolbox');
    this.HorizontalToolbar = this.toolbox.HorizontalToolbar;
    this.ComponentGroup = this.toolbox.ComponentGroup;
    this.SymbolStore = this.toolbox.SymbolStore;
  }
  LegendExt.prototype.constructor = LegendExt;

  LegendExt.prototype.renderChange = function () {
    var chartInstance = this.tsObject.chartInstance,
      componentStore = chartInstance.apiInstance.getComponentStore(),
      i = 0;
    for (i = 0; componentStore.getCanvasByIndex(i); ++i) {
      componentStore.getCanvasByIndex(i).getComposition().PlotManager.plot();
    }
  };

  LegendExt.prototype.analyser = function (mode) {
    var ga = this.ga || {},
      store = this.tsObject.apiInstance.getComponentStore(),
      canvas = store.getCanvasByIndex(0),
      nav = store.getNavigatorByIndex(0),
      comp = canvas.getComposition(),
      ds = ga.ds || comp.dataset,
      i,
      idMap = ga.idMap || {},
      storeAr = ga.storeAr || [],
      nStoreArr = [];
    // Declaration ends
    this.ga = ga;
    if (!ga.storeAr) {
      store = {};
      if (!ga.idMap) {
        ds.forEachSeries(function (a, b, c, series) {
          store[series.getId()] = series.getOriginalData();
        });
        for (i in store) {
          storeAr.push(store[i]);
          idMap[i] = storeAr.length - 1;
          // = store[i].map(function (e) { return 20 * e + (Math.random() * 1000); });
        }
        ga.idMap = idMap;
        ga.ds = ds;
        ga.storeAr = storeAr;
        ga.gAnalyser = new GrowthAnalyser(storeAr);
      }
    }
    nStoreArr = ga.gAnalyser.analyse(mode);
    ds.setDataBySeries(function (series) {
      if (nStoreArr.length) {
        series.setOriginalData(nStoreArr[idMap[series.getId()]]);
      }
    });
    comp.impl.update();
  };

  LegendExt.prototype.init = function (require) {
    var instance = this;
    require([
      'xAxis',
      'yAxis',
      'graphics',
      'chart',
      'dataset',
      'PlotManager',
      'canvasConfig',
      'MarkerManager',
      'reactiveModel',
      'globalReactiveModel',
      'spaceManagerInstance',
      'smartLabel',
      'chartInstance',
      function (
            xAxis,
            yAxis,
            graphics,
            chart,
            dataset,
            plotManager,
            canvasConfig,
            markerManager,
            reactiveModel,
            globalReactiveModel,
            spaceManagerInstance,
            smartLabel,
            chartInstance) {
        instance.xAxis = xAxis;
        instance.yAxis = yAxis;
        instance.graphics = graphics;
        instance.chart = chart;
        instance.dataset = dataset;
        instance.plotManager = plotManager;
        instance.markerManager = markerManager;
        instance.canvasConfig = canvasConfig;
        instance.reactiveModel = reactiveModel;
        instance.globalReactiveModel = globalReactiveModel;
        instance.spaceManagerInstance = spaceManagerInstance;
        instance.smartLabel = smartLabel;
        instance.chartInstance = chartInstance;
      }
    ]);
    this.spaceManagerInstance = instance.spaceManagerInstance;
    this.globalReactiveModel = instance.globalReactiveModel;
    this.tsObject = instance.chartInstance;
    this.startDt = instance.globalReactiveModel.model['x-axis-visible-range-start'];
    this.endDt = instance.globalReactiveModel.model['x-axis-visible-range-end'];
    this.startDataset = instance.globalReactiveModel.model['x-axis-absolute-range-start'];
    this.endDataset = instance.globalReactiveModel.model['x-axis-absolute-range-end'];
    this.toolbars = [];
    this.measurement = {};
    this.toolbars.push(this.createToolbar());
    return this;
  };

  LegendExt.prototype.createToolbar = function () {
    var toolbar,
      group,
      selectMenu,
      self = this,
      resetButton,
      label,
      contextMenu,
      contextArray = [],
      i,
      gaOptionsObj = {},
      key,
      obj = {},
      popup,
      paper = this.graphics.paper,
      chartContainer = this.graphics.container;

    toolbar = new this.HorizontalToolbar({
      paper: this.graphics.paper,
      chart: this.chart,
      smartLabel: this.smartLabel,
      chartContainer: this.graphics.container
    });

    toolbar.setConfig({
      fill: '#fff',
      borderThickness: 0
    });

    group = new this.toolbox.ComponentGroup({
      paper: this.graphics.paper,
      chart: this.chart,
      smartLabel: this.smartLabel,
      chartContainer: this.graphics.container
    });

    group.setConfig({
      fill: '#fff',
      borderThickness: 0
    });

    gaOptionsObj = {
      'Fixed-Number': 'dialogBox',
      'Functions': ['min', 'max', 'mean', 'median', 'sd'],
      'Position': 'dialogBox',
      'Dataset': ['Dataset ' + '1', 'Dataset ' + '2'],
      'Relative-Position': 'dialogBox'
    };

    // selectMenu = new this.toolbox.SelectSymbol({
    //   width: 100,
    //   height: 22
    // }, {
    //   paper: this.graphics.paper,
    //   chart: this.chart,
    //   smartLabel: this.smartLabel,
    //   chartContainer: this.graphics.container
    // }, [{
    //   name: 'Fixed Number',
    //   value: 'analyse-fixed-number'
    // },
    // {
    //   name: 'Functions',
    //   value: 'analyse-functions'
    // }, {
    //   name: 'Position',
    //   value: 'analyse-position'
    // }, {
    //   name: 'Dataset',
    //   value: 'analyse-dataset'
    // }, {
    //   name: 'Relative position',
    //   value: 'analyse-relposition'
    // }], {
    //   strokeWidth: 1,
    //   stroke: 'rgba(102,102,102,0.5)',
    //   symbolStrokeWidth: 0,
    //   labelFill: '#000000',
    //   btnTextStyle: {
    //     fontSize: 14
    //   }
    // });

    // selectMenu.attachEventHandlers({
    //   textOnChange: function () {
    //     // self.fromDate.blur();
    //     // self.startDate = self.fromDate.getText();
    //     // `.log(self.fromDate.getText());
    //     if (selectMenu.value() === 'analyse-fixed-number') {
    //       self.analyser(parseInt(window.prompt('Enter value')));
    //     } else if (selectMenu.value() === 'analyse-functions') {
    //       let str = window.prompt('Enter value');
    //       self.analyser(str);
    //     } else if (selectMenu.value() === 'analyse-position') {
    //       self.analyser({position: 0});
    //     } else if (selectMenu.value() === 'analyse-dataset') {
    //       self.analyser({reldatasetposition: -1});
    //     } else if (selectMenu.value() === 'analyse-relposition') {
    //       self.analyser({relposition: -20});
    //     }
    //   }
    // });

    // resetButton = new this.toolbox.Symbol('RESET', true, {
    //   paper: this.graphics.paper,
    //   chart: this.chart,
    //   smartLabel: this.smartLabel,
    //   chartContainer: this.graphics.container
    // }, {
    //   fill: '#555',
    //   labelFill: '#00ff00',
    //   hoverFill: '#00ff00',
    //   width: 30,
    //   height: 20,
    //   btnTextStyle: {
    //     fontSize: 11
    //   }
    // }).attachEventHandlers({
    //   click: function () {
    //       // apply(1);
    //   }
    // });

    // contextMenu = new this.toolbox.SymbolWithContext('ContextIcon', {
    //   paper: this.graphics.paper,
    //   chart: this.chart,
    //   smartLabel: this.smartLabel,
    //   chartContainer: this.graphics.container
    // }, {
    //   width: 15,
    //   height: 15,
    //   strokeWidth: 1,
    //   stroke: '#7f7f7f',
    //   radius: 2
    // });

    // contextMenu.appendAsList([
    //   {
    //     'Export In PNG': {
    //       handler: function () {
    //           // console.log('Reset');
    //       },
    //       action: 'click'
    //     }
    //   },
    //   {
    //     'Export In PDF': {
    //       handler: function () {
    //           // console.log('Update');
    //       },
    //       action: 'click'
    //     }
    //   }
    // ]);

    contextMenu = new this.toolbox.SymbolWithContext('ContextIcon', {
      paper: this.graphics.paper,
      chart: this.chart,
      smartLabel: this.smartLabel,
      chartContainer: this.graphics.container
    }, {
      width: 20,
      height: 20,
      position: 'right'
    });

    contextArray.push({
      '<b>Growth Analyser</b>': {}
    });
    popup = function (callback) {
      var box,
        header,
        style = {
          fontSize: 10 + 'px',
          lineHeight: 15 + 'px',
          fontFamily: 'Lucida Grande',
          stroke: '#000000',
          'stroke-width': '2'
        },
        headerWidth = 180,
        headerText,
        cross,
        inputField,
        applyButton,
        x = 500,
        y = 100;

      box = paper.html('div', {
        fill: '#f1e8e8',
        x: x,
        y: y,
        width: 180,
        height: 80
      }, style, chartContainer);

      header = paper.html('div', {
        fill: '#afa695',
        width: headerWidth,
        height: 20
      }, style, box);

      headerText = paper.html('div', {
        fill: 'transparent',
        width: headerWidth * 0.6,
        height: 20,
        x: 10,
        y: 2
      }, style, header);

      headerText.attr({
        text: 'Provide Specific Value'
      });

      cross = paper.html('div', {
        fill: 'transparent',
        width: 10,
        height: 10,
        x: 10 + (headerWidth * 0.6),
        y: 2,
        text: 'X',
        cursor: 'pointer'
      }, style, header);

      cross.on('click', function () {
        box.hide();
      });

      inputField = paper.html('input', {
        width: 100,
        height: 20,
        x: 10,
        y: 30
      }, style, box);

      applyButton = paper.html('div', {
        width: 50,
        height: 20,
        x: 120,
        y: 30,
        fill: '#525252'
      }, {
        fontSize: 10 + 'px',
        lineHeight: 15 + 'px',
        fontFamily: 'Lucida Grande',
        fill: '#ffffff',
        cursor: 'pointer'
      }, box);

      applyButton.on('click', function () {
        box.hide();
        callback(inputField.val());
      });

      applyButton.attr({
        text: 'APPLY'
      });
    };

    for (let i in gaOptionsObj) {
      let key,
        obj = {},
        subObj = {};
      if (gaOptionsObj[i] === 'dialogBox') {
        key = '&nbsp; &nbsp; ' + i;
        obj[key] = {};
        obj[key] = {
          handler: function () {
            console.log(i);
            let popupVal = popup(function (str) {
              self.analyser(parseInt(str));
            });
          },
          action: 'click'
        };
      } else {
        key = '&#9666&nbsp; ' + i;
        obj[key] = {};
        obj[key].action = 'click';
        obj[key].handler = [];
        for (let j = 0; j < gaOptionsObj[i].length; j++) {
          let subMenuName = gaOptionsObj[i][j];
          subObj = {};
          subObj['&nbsp;' + subMenuName] = {};
          console.log(subMenuName);
          subObj['&nbsp;' + subMenuName].handler = function () {
            console.log(subMenuName, i, j);
          };
          subObj['&nbsp;' + subMenuName].action = 'click';
          obj[key].handler.push(subObj);
        }
      }
      console.log(contextArray);
      contextArray.push(obj);
      contextArray.push({
        '': {
          style: {
            backgroundColor: '#000000',
            height: '1px',
            margin: '1px',
            padding: '0px',
            opacity: '0.3'

          }
        }
      });
    }

    contextMenu.appendAsList(contextArray);

    this.SymbolStore.register('ContextIcon', function (posx, posy, rad) {
      var x = posx,
        y = posy,
        r = rad * 2,
        space = Math.round(r / 4),
        halfWidth = Math.round(r / 2) * 0.7,
        startX = (x - halfWidth),
        endX = (x + halfWidth),
        startY = (y + space),
        endY = (y - space);
      return ['M', startX, y, 'L', endX, y, 'M', startX, startY, 'L', endX, startY, 'M', startX, endY, 'L', endX, endY];
    });

    // this.SymbolStore.register('textBoxIcon', function (x, y, rad, w, h, padX, padY) {
    //   var x1 = x - w / 2 + padX / 2,
    //     x2 = x + w / 2 - padX / 2,
    //     y1 = y - h / 2 + padY / 2,
    //     y2 = y + h / 2 - padY / 2;

    //   return ['M', x1, y1, 'L', x2, y1, 'L', x2, y2, 'L', x1, y2, 'Z'];
    // });

    // group.addSymbol(selectMenu);
    // group.addSymbol(resetButton);
    group.addSymbol(contextMenu);
    toolbar.addComponent(group);
    return toolbar;
  };

  LegendExt.prototype.getLogicalSpace = function (availableWidth, availableHeight) {
    availableWidth /= 2;
    var logicalSpace,
      width = 0,
      height = 0,
      i,
      ln;

    for (i = 0, ln = this.toolbars.length; i < ln; i++) {
      logicalSpace = this.toolbars[i].getLogicalSpace(availableWidth, availableHeight);
      width = Math.max(logicalSpace.width, width);
      height += logicalSpace.height;
      this.toolbars[i].width = logicalSpace.width;
      this.toolbars[i].height = logicalSpace.height;
    }
    height += this.padding;
    return {
      width: width > availableWidth ? 0 : width,
      height: height > availableHeight ? 0 : height
    };
  };

  LegendExt.prototype.placeInCanvas = function () {
    var self = this;
    self.padding = 5;
    self.spaceManagerInstance.add([{
      name: function () {
        return 'ToolBoxExt';
      },
      ref: function (obj) {
        return obj['0'];
      },
      self: function () {
        return self;
      },
      priority: function () {
        return 2;
      },
      layout: function (obj) {
        return obj.inline;
      },
      orientation: [{
        type: function (obj) {
          return obj.horizontal;
        },
        position: [{
          type: function (obj) {
            return obj.top;
          },
          alignment: [{
            type: function (obj) {
              return obj.right;
            },
            dimensions: [function () {
              var parent = this.getParentComponentGroup();
              return self.getLogicalSpace(parent.getWidth(), parent.getHeight());
            }]
          }]
        }]
      }]
    }]);
  };

  LegendExt.prototype.setDrawingConfiguration = function (x, y, width, height, group) {
    var mes = this.measurement;
    mes.x = x;
    mes.y = y;
    mes.width = width;
    mes.height = height;

    this.parentGroup = group;

    return this;
  };

  LegendExt.prototype.draw = function (x, y, width, height, group) {
    var measurement = this.measurement,
      toolbars = this.toolbars,
      ln,
      i,
      toolbar;
    x = x === undefined ? measurement.x : x;
    y = y === undefined ? measurement.y : y;
    width = width === undefined ? measurement.width : width;
    height = height === undefined ? measurement.height : height;
    group = group === undefined ? this.parentGroup : group;
    if (width && height) {
      for (i = 0, ln = toolbars.length; i < ln; i++) {
        toolbar = toolbars[i];
        toolbar.draw(x, y);
      }
    }
  };

  FusionCharts.registerComponent('extensions', 'legendExt', LegendExt);
}]);

'use strict';
class GrowthAnalyser {
  constructor (data) {
    this.data = data.map((a) => {
      return a.map((b) => { return b; });
    });
    this.Formulae = Formulae;
  }
  analyse (mode) {
    let i = 0,
      ii = 0,
      j = 0,
      jj = 0,
      num = 0,
      checkArr = [],
      checkNum = 0,
      dataAr = this.data,
      nDataAr = [],
      tempAr = [];
    if (!isNaN(mode)) { // Handling a number
      checkNum = +mode;
      for (i = 0, ii = dataAr.length; i < ii; ++i) {
        tempAr = [];
        for (j = 0, jj = dataAr[i].length; j < jj; ++j) {
          num = dataAr[i][j];
          tempAr.push(100 * (num - checkNum) / checkNum);
        }
        nDataAr.push(tempAr);
      }
    } else if (typeof mode === 'string') {
      mode = this.Formulae[mode];
      for (i = 0, ii = dataAr.length; i < ii; ++i) {
        tempAr = [];
        checkNum = mode(dataAr[i]);
        for (j = 0, jj = dataAr[i].length; j < jj; ++j) {
          num = dataAr[i][j];
          tempAr.push(100 * (num - checkNum) / checkNum);
        }
        nDataAr.push(tempAr);
      }
    } else if (!isNaN(mode.relposition)) {
      mode = mode.relposition;
      for (i = 0, ii = dataAr.length; i < ii; ++i) {
        tempAr = [];
        for (j = 0, jj = dataAr[i].length; j < jj; ++j) {
          num = dataAr[i][j];
          if (j + mode >= 0 && j + mode < jj) {
            checkNum = dataAr[i][j + mode];
          } else {
            checkNum = num;
          }
          tempAr.push(100 * (num - checkNum) / checkNum);
        }
        nDataAr.push(tempAr);
      }
    } else if (!isNaN(mode.position)) {
      mode = mode.position;
      for (i = 0, ii = dataAr.length; i < ii; ++i) {
        tempAr = [];
        for (j = 0, jj = dataAr[i].length; j < jj; ++j) {
          num = dataAr[i][j];
          if (mode >= 0 && mode < jj) {
            checkNum = dataAr[i][mode];
          } else {
            checkNum = num;
          }
          tempAr.push(100 * (num - checkNum) / checkNum);
        }
        nDataAr.push(tempAr);
      }
    } else if (!isNaN(mode.reldatasetposition)) {
      mode = mode.reldatasetposition;
      for (i = 0, ii = dataAr.length; i < ii; ++i) {
        tempAr = [];
        if (i + mode >= 0 && i + mode < ii) {
          checkArr = dataAr[i + mode];
        } else {
          checkArr = dataAr[i];
        }
        for (j = 0, jj = dataAr[i].length; j < jj; ++j) {
          checkNum = checkArr[j];
          num = dataAr[i][j];
          tempAr.push(100 * (num - checkNum) / num);
        }
        nDataAr.push(tempAr);
      }
    }
    for (i = 0, ii = nDataAr.length; i < ii; ++i) {
      for (j = 0, jj = nDataAr[i].length; j < jj; ++j) {
        if (!Number.isFinite(nDataAr[i][j])) {
          nDataAr[i][j] = null;
        }
      }
    }
    return nDataAr;
  }
}

var Formulae = {
  min: (arr) => {
    return arr.reduce((a, b) => {
      return a > b ? b : a;
    });
  },
  max: (arr) => {
    return arr.reduce((a, b) => {
      return a < b ? b : a;
    });
  },
  mean: (arr) => {
    return arr.reduce((a, b) => {
      return a + b;
    }) / arr.length;
  },
  median: (arr) => {
    return arr.map((a) => a).sort((a, b) => { return a - b; })[arr.length / 2];
  },
  sd: (values) => {
    function average (data) {
      var sum, avg;
      sum = data.reduce(function (sum, value) {
        return sum + value;
      }, 0);

      avg = sum / data.length;
      return avg;
    }
    var avg = 0,
      squareDiffs = 0,
      sqrDiff = 0,
      avgSquareDiff = 0,
      stdDev = 0,
      diff = 0;
    avg = average(values);
    squareDiffs = values.map(function (value) {
      diff = value - avg;
      sqrDiff = diff * diff;
      return sqrDiff;
    });
    avgSquareDiff = average(squareDiffs);
    stdDev = Math.sqrt(avgSquareDiff);
    return stdDev;
  }
};
}(this, document));

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJncm93dGgtYW5hbHlzZXItZXM2Lm1pbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24od2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7XG5cInVzZSBzdHJpY3RcIjtcblxuRnVzaW9uQ2hhcnRzLnJlZ2lzdGVyKCdleHRlbnNpb24nLCBbJ3ByaXZhdGUnLCAnbGVnZW5kLWV4dCcsIGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTGVnZW5kRXh0ICgpIHtcbiAgICB3aW5kb3cuZ2EgPSB0aGlzO1xuICAgIHRoaXMudG9vbGJveCA9IEZ1c2lvbkNoYXJ0cy5nZXRDb21wb25lbnQoJ2FwaScsICd0b29sYm94Jyk7XG4gICAgdGhpcy5Ib3Jpem9udGFsVG9vbGJhciA9IHRoaXMudG9vbGJveC5Ib3Jpem9udGFsVG9vbGJhcjtcbiAgICB0aGlzLkNvbXBvbmVudEdyb3VwID0gdGhpcy50b29sYm94LkNvbXBvbmVudEdyb3VwO1xuICAgIHRoaXMuU3ltYm9sU3RvcmUgPSB0aGlzLnRvb2xib3guU3ltYm9sU3RvcmU7XG4gIH1cbiAgTGVnZW5kRXh0LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IExlZ2VuZEV4dDtcblxuICBMZWdlbmRFeHQucHJvdG90eXBlLnJlbmRlckNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY2hhcnRJbnN0YW5jZSA9IHRoaXMudHNPYmplY3QuY2hhcnRJbnN0YW5jZSxcbiAgICAgIGNvbXBvbmVudFN0b3JlID0gY2hhcnRJbnN0YW5jZS5hcGlJbnN0YW5jZS5nZXRDb21wb25lbnRTdG9yZSgpLFxuICAgICAgaSA9IDA7XG4gICAgZm9yIChpID0gMDsgY29tcG9uZW50U3RvcmUuZ2V0Q2FudmFzQnlJbmRleChpKTsgKytpKSB7XG4gICAgICBjb21wb25lbnRTdG9yZS5nZXRDYW52YXNCeUluZGV4KGkpLmdldENvbXBvc2l0aW9uKCkuUGxvdE1hbmFnZXIucGxvdCgpO1xuICAgIH1cbiAgfTtcblxuICBMZWdlbmRFeHQucHJvdG90eXBlLmFuYWx5c2VyID0gZnVuY3Rpb24gKG1vZGUpIHtcbiAgICB2YXIgZ2EgPSB0aGlzLmdhIHx8IHt9LFxuICAgICAgc3RvcmUgPSB0aGlzLnRzT2JqZWN0LmFwaUluc3RhbmNlLmdldENvbXBvbmVudFN0b3JlKCksXG4gICAgICBjYW52YXMgPSBzdG9yZS5nZXRDYW52YXNCeUluZGV4KDApLFxuICAgICAgbmF2ID0gc3RvcmUuZ2V0TmF2aWdhdG9yQnlJbmRleCgwKSxcbiAgICAgIGNvbXAgPSBjYW52YXMuZ2V0Q29tcG9zaXRpb24oKSxcbiAgICAgIGRzID0gZ2EuZHMgfHwgY29tcC5kYXRhc2V0LFxuICAgICAgaSxcbiAgICAgIGlkTWFwID0gZ2EuaWRNYXAgfHwge30sXG4gICAgICBzdG9yZUFyID0gZ2Euc3RvcmVBciB8fCBbXSxcbiAgICAgIG5TdG9yZUFyciA9IFtdO1xuICAgIC8vIERlY2xhcmF0aW9uIGVuZHNcbiAgICB0aGlzLmdhID0gZ2E7XG4gICAgaWYgKCFnYS5zdG9yZUFyKSB7XG4gICAgICBzdG9yZSA9IHt9O1xuICAgICAgaWYgKCFnYS5pZE1hcCkge1xuICAgICAgICBkcy5mb3JFYWNoU2VyaWVzKGZ1bmN0aW9uIChhLCBiLCBjLCBzZXJpZXMpIHtcbiAgICAgICAgICBzdG9yZVtzZXJpZXMuZ2V0SWQoKV0gPSBzZXJpZXMuZ2V0T3JpZ2luYWxEYXRhKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBmb3IgKGkgaW4gc3RvcmUpIHtcbiAgICAgICAgICBzdG9yZUFyLnB1c2goc3RvcmVbaV0pO1xuICAgICAgICAgIGlkTWFwW2ldID0gc3RvcmVBci5sZW5ndGggLSAxO1xuICAgICAgICAgIC8vID0gc3RvcmVbaV0ubWFwKGZ1bmN0aW9uIChlKSB7IHJldHVybiAyMCAqIGUgKyAoTWF0aC5yYW5kb20oKSAqIDEwMDApOyB9KTtcbiAgICAgICAgfVxuICAgICAgICBnYS5pZE1hcCA9IGlkTWFwO1xuICAgICAgICBnYS5kcyA9IGRzO1xuICAgICAgICBnYS5zdG9yZUFyID0gc3RvcmVBcjtcbiAgICAgICAgZ2EuZ0FuYWx5c2VyID0gbmV3IEdyb3d0aEFuYWx5c2VyKHN0b3JlQXIpO1xuICAgICAgfVxuICAgIH1cbiAgICBuU3RvcmVBcnIgPSBnYS5nQW5hbHlzZXIuYW5hbHlzZShtb2RlKTtcbiAgICBkcy5zZXREYXRhQnlTZXJpZXMoZnVuY3Rpb24gKHNlcmllcykge1xuICAgICAgaWYgKG5TdG9yZUFyci5sZW5ndGgpIHtcbiAgICAgICAgc2VyaWVzLnNldE9yaWdpbmFsRGF0YShuU3RvcmVBcnJbaWRNYXBbc2VyaWVzLmdldElkKCldXSk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgY29tcC5pbXBsLnVwZGF0ZSgpO1xuICB9O1xuXG4gIExlZ2VuZEV4dC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIChyZXF1aXJlKSB7XG4gICAgdmFyIGluc3RhbmNlID0gdGhpcztcbiAgICByZXF1aXJlKFtcbiAgICAgICd4QXhpcycsXG4gICAgICAneUF4aXMnLFxuICAgICAgJ2dyYXBoaWNzJyxcbiAgICAgICdjaGFydCcsXG4gICAgICAnZGF0YXNldCcsXG4gICAgICAnUGxvdE1hbmFnZXInLFxuICAgICAgJ2NhbnZhc0NvbmZpZycsXG4gICAgICAnTWFya2VyTWFuYWdlcicsXG4gICAgICAncmVhY3RpdmVNb2RlbCcsXG4gICAgICAnZ2xvYmFsUmVhY3RpdmVNb2RlbCcsXG4gICAgICAnc3BhY2VNYW5hZ2VySW5zdGFuY2UnLFxuICAgICAgJ3NtYXJ0TGFiZWwnLFxuICAgICAgJ2NoYXJ0SW5zdGFuY2UnLFxuICAgICAgZnVuY3Rpb24gKFxuICAgICAgICAgICAgeEF4aXMsXG4gICAgICAgICAgICB5QXhpcyxcbiAgICAgICAgICAgIGdyYXBoaWNzLFxuICAgICAgICAgICAgY2hhcnQsXG4gICAgICAgICAgICBkYXRhc2V0LFxuICAgICAgICAgICAgcGxvdE1hbmFnZXIsXG4gICAgICAgICAgICBjYW52YXNDb25maWcsXG4gICAgICAgICAgICBtYXJrZXJNYW5hZ2VyLFxuICAgICAgICAgICAgcmVhY3RpdmVNb2RlbCxcbiAgICAgICAgICAgIGdsb2JhbFJlYWN0aXZlTW9kZWwsXG4gICAgICAgICAgICBzcGFjZU1hbmFnZXJJbnN0YW5jZSxcbiAgICAgICAgICAgIHNtYXJ0TGFiZWwsXG4gICAgICAgICAgICBjaGFydEluc3RhbmNlKSB7XG4gICAgICAgIGluc3RhbmNlLnhBeGlzID0geEF4aXM7XG4gICAgICAgIGluc3RhbmNlLnlBeGlzID0geUF4aXM7XG4gICAgICAgIGluc3RhbmNlLmdyYXBoaWNzID0gZ3JhcGhpY3M7XG4gICAgICAgIGluc3RhbmNlLmNoYXJ0ID0gY2hhcnQ7XG4gICAgICAgIGluc3RhbmNlLmRhdGFzZXQgPSBkYXRhc2V0O1xuICAgICAgICBpbnN0YW5jZS5wbG90TWFuYWdlciA9IHBsb3RNYW5hZ2VyO1xuICAgICAgICBpbnN0YW5jZS5tYXJrZXJNYW5hZ2VyID0gbWFya2VyTWFuYWdlcjtcbiAgICAgICAgaW5zdGFuY2UuY2FudmFzQ29uZmlnID0gY2FudmFzQ29uZmlnO1xuICAgICAgICBpbnN0YW5jZS5yZWFjdGl2ZU1vZGVsID0gcmVhY3RpdmVNb2RlbDtcbiAgICAgICAgaW5zdGFuY2UuZ2xvYmFsUmVhY3RpdmVNb2RlbCA9IGdsb2JhbFJlYWN0aXZlTW9kZWw7XG4gICAgICAgIGluc3RhbmNlLnNwYWNlTWFuYWdlckluc3RhbmNlID0gc3BhY2VNYW5hZ2VySW5zdGFuY2U7XG4gICAgICAgIGluc3RhbmNlLnNtYXJ0TGFiZWwgPSBzbWFydExhYmVsO1xuICAgICAgICBpbnN0YW5jZS5jaGFydEluc3RhbmNlID0gY2hhcnRJbnN0YW5jZTtcbiAgICAgIH1cbiAgICBdKTtcbiAgICB0aGlzLnNwYWNlTWFuYWdlckluc3RhbmNlID0gaW5zdGFuY2Uuc3BhY2VNYW5hZ2VySW5zdGFuY2U7XG4gICAgdGhpcy5nbG9iYWxSZWFjdGl2ZU1vZGVsID0gaW5zdGFuY2UuZ2xvYmFsUmVhY3RpdmVNb2RlbDtcbiAgICB0aGlzLnRzT2JqZWN0ID0gaW5zdGFuY2UuY2hhcnRJbnN0YW5jZTtcbiAgICB0aGlzLnN0YXJ0RHQgPSBpbnN0YW5jZS5nbG9iYWxSZWFjdGl2ZU1vZGVsLm1vZGVsWyd4LWF4aXMtdmlzaWJsZS1yYW5nZS1zdGFydCddO1xuICAgIHRoaXMuZW5kRHQgPSBpbnN0YW5jZS5nbG9iYWxSZWFjdGl2ZU1vZGVsLm1vZGVsWyd4LWF4aXMtdmlzaWJsZS1yYW5nZS1lbmQnXTtcbiAgICB0aGlzLnN0YXJ0RGF0YXNldCA9IGluc3RhbmNlLmdsb2JhbFJlYWN0aXZlTW9kZWwubW9kZWxbJ3gtYXhpcy1hYnNvbHV0ZS1yYW5nZS1zdGFydCddO1xuICAgIHRoaXMuZW5kRGF0YXNldCA9IGluc3RhbmNlLmdsb2JhbFJlYWN0aXZlTW9kZWwubW9kZWxbJ3gtYXhpcy1hYnNvbHV0ZS1yYW5nZS1lbmQnXTtcbiAgICB0aGlzLnRvb2xiYXJzID0gW107XG4gICAgdGhpcy5tZWFzdXJlbWVudCA9IHt9O1xuICAgIHRoaXMudG9vbGJhcnMucHVzaCh0aGlzLmNyZWF0ZVRvb2xiYXIoKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgTGVnZW5kRXh0LnByb3RvdHlwZS5jcmVhdGVUb29sYmFyID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB0b29sYmFyLFxuICAgICAgZ3JvdXAsXG4gICAgICBzZWxlY3RNZW51LFxuICAgICAgc2VsZiA9IHRoaXMsXG4gICAgICByZXNldEJ1dHRvbixcbiAgICAgIGxhYmVsLFxuICAgICAgY29udGV4dE1lbnUsXG4gICAgICBjb250ZXh0QXJyYXkgPSBbXSxcbiAgICAgIGksXG4gICAgICBnYU9wdGlvbnNPYmogPSB7fSxcbiAgICAgIGtleSxcbiAgICAgIG9iaiA9IHt9LFxuICAgICAgcG9wdXAsXG4gICAgICBwYXBlciA9IHRoaXMuZ3JhcGhpY3MucGFwZXIsXG4gICAgICBjaGFydENvbnRhaW5lciA9IHRoaXMuZ3JhcGhpY3MuY29udGFpbmVyO1xuXG4gICAgdG9vbGJhciA9IG5ldyB0aGlzLkhvcml6b250YWxUb29sYmFyKHtcbiAgICAgIHBhcGVyOiB0aGlzLmdyYXBoaWNzLnBhcGVyLFxuICAgICAgY2hhcnQ6IHRoaXMuY2hhcnQsXG4gICAgICBzbWFydExhYmVsOiB0aGlzLnNtYXJ0TGFiZWwsXG4gICAgICBjaGFydENvbnRhaW5lcjogdGhpcy5ncmFwaGljcy5jb250YWluZXJcbiAgICB9KTtcblxuICAgIHRvb2xiYXIuc2V0Q29uZmlnKHtcbiAgICAgIGZpbGw6ICcjZmZmJyxcbiAgICAgIGJvcmRlclRoaWNrbmVzczogMFxuICAgIH0pO1xuXG4gICAgZ3JvdXAgPSBuZXcgdGhpcy50b29sYm94LkNvbXBvbmVudEdyb3VwKHtcbiAgICAgIHBhcGVyOiB0aGlzLmdyYXBoaWNzLnBhcGVyLFxuICAgICAgY2hhcnQ6IHRoaXMuY2hhcnQsXG4gICAgICBzbWFydExhYmVsOiB0aGlzLnNtYXJ0TGFiZWwsXG4gICAgICBjaGFydENvbnRhaW5lcjogdGhpcy5ncmFwaGljcy5jb250YWluZXJcbiAgICB9KTtcblxuICAgIGdyb3VwLnNldENvbmZpZyh7XG4gICAgICBmaWxsOiAnI2ZmZicsXG4gICAgICBib3JkZXJUaGlja25lc3M6IDBcbiAgICB9KTtcblxuICAgIGdhT3B0aW9uc09iaiA9IHtcbiAgICAgICdGaXhlZC1OdW1iZXInOiAnZGlhbG9nQm94JyxcbiAgICAgICdGdW5jdGlvbnMnOiBbJ21pbicsICdtYXgnLCAnbWVhbicsICdtZWRpYW4nLCAnc2QnXSxcbiAgICAgICdQb3NpdGlvbic6ICdkaWFsb2dCb3gnLFxuICAgICAgJ0RhdGFzZXQnOiBbJ0RhdGFzZXQgJyArICcxJywgJ0RhdGFzZXQgJyArICcyJ10sXG4gICAgICAnUmVsYXRpdmUtUG9zaXRpb24nOiAnZGlhbG9nQm94J1xuICAgIH07XG5cbiAgICAvLyBzZWxlY3RNZW51ID0gbmV3IHRoaXMudG9vbGJveC5TZWxlY3RTeW1ib2woe1xuICAgIC8vICAgd2lkdGg6IDEwMCxcbiAgICAvLyAgIGhlaWdodDogMjJcbiAgICAvLyB9LCB7XG4gICAgLy8gICBwYXBlcjogdGhpcy5ncmFwaGljcy5wYXBlcixcbiAgICAvLyAgIGNoYXJ0OiB0aGlzLmNoYXJ0LFxuICAgIC8vICAgc21hcnRMYWJlbDogdGhpcy5zbWFydExhYmVsLFxuICAgIC8vICAgY2hhcnRDb250YWluZXI6IHRoaXMuZ3JhcGhpY3MuY29udGFpbmVyXG4gICAgLy8gfSwgW3tcbiAgICAvLyAgIG5hbWU6ICdGaXhlZCBOdW1iZXInLFxuICAgIC8vICAgdmFsdWU6ICdhbmFseXNlLWZpeGVkLW51bWJlcidcbiAgICAvLyB9LFxuICAgIC8vIHtcbiAgICAvLyAgIG5hbWU6ICdGdW5jdGlvbnMnLFxuICAgIC8vICAgdmFsdWU6ICdhbmFseXNlLWZ1bmN0aW9ucydcbiAgICAvLyB9LCB7XG4gICAgLy8gICBuYW1lOiAnUG9zaXRpb24nLFxuICAgIC8vICAgdmFsdWU6ICdhbmFseXNlLXBvc2l0aW9uJ1xuICAgIC8vIH0sIHtcbiAgICAvLyAgIG5hbWU6ICdEYXRhc2V0JyxcbiAgICAvLyAgIHZhbHVlOiAnYW5hbHlzZS1kYXRhc2V0J1xuICAgIC8vIH0sIHtcbiAgICAvLyAgIG5hbWU6ICdSZWxhdGl2ZSBwb3NpdGlvbicsXG4gICAgLy8gICB2YWx1ZTogJ2FuYWx5c2UtcmVscG9zaXRpb24nXG4gICAgLy8gfV0sIHtcbiAgICAvLyAgIHN0cm9rZVdpZHRoOiAxLFxuICAgIC8vICAgc3Ryb2tlOiAncmdiYSgxMDIsMTAyLDEwMiwwLjUpJyxcbiAgICAvLyAgIHN5bWJvbFN0cm9rZVdpZHRoOiAwLFxuICAgIC8vICAgbGFiZWxGaWxsOiAnIzAwMDAwMCcsXG4gICAgLy8gICBidG5UZXh0U3R5bGU6IHtcbiAgICAvLyAgICAgZm9udFNpemU6IDE0XG4gICAgLy8gICB9XG4gICAgLy8gfSk7XG5cbiAgICAvLyBzZWxlY3RNZW51LmF0dGFjaEV2ZW50SGFuZGxlcnMoe1xuICAgIC8vICAgdGV4dE9uQ2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICAgIC8vIHNlbGYuZnJvbURhdGUuYmx1cigpO1xuICAgIC8vICAgICAvLyBzZWxmLnN0YXJ0RGF0ZSA9IHNlbGYuZnJvbURhdGUuZ2V0VGV4dCgpO1xuICAgIC8vICAgICAvLyBgLmxvZyhzZWxmLmZyb21EYXRlLmdldFRleHQoKSk7XG4gICAgLy8gICAgIGlmIChzZWxlY3RNZW51LnZhbHVlKCkgPT09ICdhbmFseXNlLWZpeGVkLW51bWJlcicpIHtcbiAgICAvLyAgICAgICBzZWxmLmFuYWx5c2VyKHBhcnNlSW50KHdpbmRvdy5wcm9tcHQoJ0VudGVyIHZhbHVlJykpKTtcbiAgICAvLyAgICAgfSBlbHNlIGlmIChzZWxlY3RNZW51LnZhbHVlKCkgPT09ICdhbmFseXNlLWZ1bmN0aW9ucycpIHtcbiAgICAvLyAgICAgICBsZXQgc3RyID0gd2luZG93LnByb21wdCgnRW50ZXIgdmFsdWUnKTtcbiAgICAvLyAgICAgICBzZWxmLmFuYWx5c2VyKHN0cik7XG4gICAgLy8gICAgIH0gZWxzZSBpZiAoc2VsZWN0TWVudS52YWx1ZSgpID09PSAnYW5hbHlzZS1wb3NpdGlvbicpIHtcbiAgICAvLyAgICAgICBzZWxmLmFuYWx5c2VyKHtwb3NpdGlvbjogMH0pO1xuICAgIC8vICAgICB9IGVsc2UgaWYgKHNlbGVjdE1lbnUudmFsdWUoKSA9PT0gJ2FuYWx5c2UtZGF0YXNldCcpIHtcbiAgICAvLyAgICAgICBzZWxmLmFuYWx5c2VyKHtyZWxkYXRhc2V0cG9zaXRpb246IC0xfSk7XG4gICAgLy8gICAgIH0gZWxzZSBpZiAoc2VsZWN0TWVudS52YWx1ZSgpID09PSAnYW5hbHlzZS1yZWxwb3NpdGlvbicpIHtcbiAgICAvLyAgICAgICBzZWxmLmFuYWx5c2VyKHtyZWxwb3NpdGlvbjogLTIwfSk7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH1cbiAgICAvLyB9KTtcblxuICAgIC8vIHJlc2V0QnV0dG9uID0gbmV3IHRoaXMudG9vbGJveC5TeW1ib2woJ1JFU0VUJywgdHJ1ZSwge1xuICAgIC8vICAgcGFwZXI6IHRoaXMuZ3JhcGhpY3MucGFwZXIsXG4gICAgLy8gICBjaGFydDogdGhpcy5jaGFydCxcbiAgICAvLyAgIHNtYXJ0TGFiZWw6IHRoaXMuc21hcnRMYWJlbCxcbiAgICAvLyAgIGNoYXJ0Q29udGFpbmVyOiB0aGlzLmdyYXBoaWNzLmNvbnRhaW5lclxuICAgIC8vIH0sIHtcbiAgICAvLyAgIGZpbGw6ICcjNTU1JyxcbiAgICAvLyAgIGxhYmVsRmlsbDogJyMwMGZmMDAnLFxuICAgIC8vICAgaG92ZXJGaWxsOiAnIzAwZmYwMCcsXG4gICAgLy8gICB3aWR0aDogMzAsXG4gICAgLy8gICBoZWlnaHQ6IDIwLFxuICAgIC8vICAgYnRuVGV4dFN0eWxlOiB7XG4gICAgLy8gICAgIGZvbnRTaXplOiAxMVxuICAgIC8vICAgfVxuICAgIC8vIH0pLmF0dGFjaEV2ZW50SGFuZGxlcnMoe1xuICAgIC8vICAgY2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICAgICAvLyBhcHBseSgxKTtcbiAgICAvLyAgIH1cbiAgICAvLyB9KTtcblxuICAgIC8vIGNvbnRleHRNZW51ID0gbmV3IHRoaXMudG9vbGJveC5TeW1ib2xXaXRoQ29udGV4dCgnQ29udGV4dEljb24nLCB7XG4gICAgLy8gICBwYXBlcjogdGhpcy5ncmFwaGljcy5wYXBlcixcbiAgICAvLyAgIGNoYXJ0OiB0aGlzLmNoYXJ0LFxuICAgIC8vICAgc21hcnRMYWJlbDogdGhpcy5zbWFydExhYmVsLFxuICAgIC8vICAgY2hhcnRDb250YWluZXI6IHRoaXMuZ3JhcGhpY3MuY29udGFpbmVyXG4gICAgLy8gfSwge1xuICAgIC8vICAgd2lkdGg6IDE1LFxuICAgIC8vICAgaGVpZ2h0OiAxNSxcbiAgICAvLyAgIHN0cm9rZVdpZHRoOiAxLFxuICAgIC8vICAgc3Ryb2tlOiAnIzdmN2Y3ZicsXG4gICAgLy8gICByYWRpdXM6IDJcbiAgICAvLyB9KTtcblxuICAgIC8vIGNvbnRleHRNZW51LmFwcGVuZEFzTGlzdChbXG4gICAgLy8gICB7XG4gICAgLy8gICAgICdFeHBvcnQgSW4gUE5HJzoge1xuICAgIC8vICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ1Jlc2V0Jyk7XG4gICAgLy8gICAgICAgfSxcbiAgICAvLyAgICAgICBhY3Rpb246ICdjbGljaydcbiAgICAvLyAgICAgfVxuICAgIC8vICAgfSxcbiAgICAvLyAgIHtcbiAgICAvLyAgICAgJ0V4cG9ydCBJbiBQREYnOiB7XG4gICAgLy8gICAgICAgaGFuZGxlcjogZnVuY3Rpb24gKCkge1xuICAgIC8vICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnVXBkYXRlJyk7XG4gICAgLy8gICAgICAgfSxcbiAgICAvLyAgICAgICBhY3Rpb246ICdjbGljaydcbiAgICAvLyAgICAgfVxuICAgIC8vICAgfVxuICAgIC8vIF0pO1xuXG4gICAgY29udGV4dE1lbnUgPSBuZXcgdGhpcy50b29sYm94LlN5bWJvbFdpdGhDb250ZXh0KCdDb250ZXh0SWNvbicsIHtcbiAgICAgIHBhcGVyOiB0aGlzLmdyYXBoaWNzLnBhcGVyLFxuICAgICAgY2hhcnQ6IHRoaXMuY2hhcnQsXG4gICAgICBzbWFydExhYmVsOiB0aGlzLnNtYXJ0TGFiZWwsXG4gICAgICBjaGFydENvbnRhaW5lcjogdGhpcy5ncmFwaGljcy5jb250YWluZXJcbiAgICB9LCB7XG4gICAgICB3aWR0aDogMjAsXG4gICAgICBoZWlnaHQ6IDIwLFxuICAgICAgcG9zaXRpb246ICdyaWdodCdcbiAgICB9KTtcblxuICAgIGNvbnRleHRBcnJheS5wdXNoKHtcbiAgICAgICc8Yj5Hcm93dGggQW5hbHlzZXI8L2I+Jzoge31cbiAgICB9KTtcbiAgICBwb3B1cCA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgdmFyIGJveCxcbiAgICAgICAgaGVhZGVyLFxuICAgICAgICBzdHlsZSA9IHtcbiAgICAgICAgICBmb250U2l6ZTogMTAgKyAncHgnLFxuICAgICAgICAgIGxpbmVIZWlnaHQ6IDE1ICsgJ3B4JyxcbiAgICAgICAgICBmb250RmFtaWx5OiAnTHVjaWRhIEdyYW5kZScsXG4gICAgICAgICAgc3Ryb2tlOiAnIzAwMDAwMCcsXG4gICAgICAgICAgJ3N0cm9rZS13aWR0aCc6ICcyJ1xuICAgICAgICB9LFxuICAgICAgICBoZWFkZXJXaWR0aCA9IDE4MCxcbiAgICAgICAgaGVhZGVyVGV4dCxcbiAgICAgICAgY3Jvc3MsXG4gICAgICAgIGlucHV0RmllbGQsXG4gICAgICAgIGFwcGx5QnV0dG9uLFxuICAgICAgICB4ID0gNTAwLFxuICAgICAgICB5ID0gMTAwO1xuXG4gICAgICBib3ggPSBwYXBlci5odG1sKCdkaXYnLCB7XG4gICAgICAgIGZpbGw6ICcjZjFlOGU4JyxcbiAgICAgICAgeDogeCxcbiAgICAgICAgeTogeSxcbiAgICAgICAgd2lkdGg6IDE4MCxcbiAgICAgICAgaGVpZ2h0OiA4MFxuICAgICAgfSwgc3R5bGUsIGNoYXJ0Q29udGFpbmVyKTtcblxuICAgICAgaGVhZGVyID0gcGFwZXIuaHRtbCgnZGl2Jywge1xuICAgICAgICBmaWxsOiAnI2FmYTY5NScsXG4gICAgICAgIHdpZHRoOiBoZWFkZXJXaWR0aCxcbiAgICAgICAgaGVpZ2h0OiAyMFxuICAgICAgfSwgc3R5bGUsIGJveCk7XG5cbiAgICAgIGhlYWRlclRleHQgPSBwYXBlci5odG1sKCdkaXYnLCB7XG4gICAgICAgIGZpbGw6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIHdpZHRoOiBoZWFkZXJXaWR0aCAqIDAuNixcbiAgICAgICAgaGVpZ2h0OiAyMCxcbiAgICAgICAgeDogMTAsXG4gICAgICAgIHk6IDJcbiAgICAgIH0sIHN0eWxlLCBoZWFkZXIpO1xuXG4gICAgICBoZWFkZXJUZXh0LmF0dHIoe1xuICAgICAgICB0ZXh0OiAnUHJvdmlkZSBTcGVjaWZpYyBWYWx1ZSdcbiAgICAgIH0pO1xuXG4gICAgICBjcm9zcyA9IHBhcGVyLmh0bWwoJ2RpdicsIHtcbiAgICAgICAgZmlsbDogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgd2lkdGg6IDEwLFxuICAgICAgICBoZWlnaHQ6IDEwLFxuICAgICAgICB4OiAxMCArIChoZWFkZXJXaWR0aCAqIDAuNiksXG4gICAgICAgIHk6IDIsXG4gICAgICAgIHRleHQ6ICdYJyxcbiAgICAgICAgY3Vyc29yOiAncG9pbnRlcidcbiAgICAgIH0sIHN0eWxlLCBoZWFkZXIpO1xuXG4gICAgICBjcm9zcy5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGJveC5oaWRlKCk7XG4gICAgICB9KTtcblxuICAgICAgaW5wdXRGaWVsZCA9IHBhcGVyLmh0bWwoJ2lucHV0Jywge1xuICAgICAgICB3aWR0aDogMTAwLFxuICAgICAgICBoZWlnaHQ6IDIwLFxuICAgICAgICB4OiAxMCxcbiAgICAgICAgeTogMzBcbiAgICAgIH0sIHN0eWxlLCBib3gpO1xuXG4gICAgICBhcHBseUJ1dHRvbiA9IHBhcGVyLmh0bWwoJ2RpdicsIHtcbiAgICAgICAgd2lkdGg6IDUwLFxuICAgICAgICBoZWlnaHQ6IDIwLFxuICAgICAgICB4OiAxMjAsXG4gICAgICAgIHk6IDMwLFxuICAgICAgICBmaWxsOiAnIzUyNTI1MidcbiAgICAgIH0sIHtcbiAgICAgICAgZm9udFNpemU6IDEwICsgJ3B4JyxcbiAgICAgICAgbGluZUhlaWdodDogMTUgKyAncHgnLFxuICAgICAgICBmb250RmFtaWx5OiAnTHVjaWRhIEdyYW5kZScsXG4gICAgICAgIGZpbGw6ICcjZmZmZmZmJyxcbiAgICAgICAgY3Vyc29yOiAncG9pbnRlcidcbiAgICAgIH0sIGJveCk7XG5cbiAgICAgIGFwcGx5QnV0dG9uLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYm94LmhpZGUoKTtcbiAgICAgICAgY2FsbGJhY2soaW5wdXRGaWVsZC52YWwoKSk7XG4gICAgICB9KTtcblxuICAgICAgYXBwbHlCdXR0b24uYXR0cih7XG4gICAgICAgIHRleHQ6ICdBUFBMWSdcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBmb3IgKGxldCBpIGluIGdhT3B0aW9uc09iaikge1xuICAgICAgbGV0IGtleSxcbiAgICAgICAgb2JqID0ge30sXG4gICAgICAgIHN1Yk9iaiA9IHt9O1xuICAgICAgaWYgKGdhT3B0aW9uc09ialtpXSA9PT0gJ2RpYWxvZ0JveCcpIHtcbiAgICAgICAga2V5ID0gJyZuYnNwOyAmbmJzcDsgJyArIGk7XG4gICAgICAgIG9ialtrZXldID0ge307XG4gICAgICAgIG9ialtrZXldID0ge1xuICAgICAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGkpO1xuICAgICAgICAgICAgbGV0IHBvcHVwVmFsID0gcG9wdXAoZnVuY3Rpb24gKHN0cikge1xuICAgICAgICAgICAgICBzZWxmLmFuYWx5c2VyKHBhcnNlSW50KHN0cikpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhY3Rpb246ICdjbGljaydcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGtleSA9ICcmIzk2NjYmbmJzcDsgJyArIGk7XG4gICAgICAgIG9ialtrZXldID0ge307XG4gICAgICAgIG9ialtrZXldLmFjdGlvbiA9ICdjbGljayc7XG4gICAgICAgIG9ialtrZXldLmhhbmRsZXIgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBnYU9wdGlvbnNPYmpbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICBsZXQgc3ViTWVudU5hbWUgPSBnYU9wdGlvbnNPYmpbaV1bal07XG4gICAgICAgICAgc3ViT2JqID0ge307XG4gICAgICAgICAgc3ViT2JqWycmbmJzcDsnICsgc3ViTWVudU5hbWVdID0ge307XG4gICAgICAgICAgY29uc29sZS5sb2coc3ViTWVudU5hbWUpO1xuICAgICAgICAgIHN1Yk9ialsnJm5ic3A7JyArIHN1Yk1lbnVOYW1lXS5oYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coc3ViTWVudU5hbWUsIGksIGopO1xuICAgICAgICAgIH07XG4gICAgICAgICAgc3ViT2JqWycmbmJzcDsnICsgc3ViTWVudU5hbWVdLmFjdGlvbiA9ICdjbGljayc7XG4gICAgICAgICAgb2JqW2tleV0uaGFuZGxlci5wdXNoKHN1Yk9iaik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKGNvbnRleHRBcnJheSk7XG4gICAgICBjb250ZXh0QXJyYXkucHVzaChvYmopO1xuICAgICAgY29udGV4dEFycmF5LnB1c2goe1xuICAgICAgICAnJzoge1xuICAgICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjMDAwMDAwJyxcbiAgICAgICAgICAgIGhlaWdodDogJzFweCcsXG4gICAgICAgICAgICBtYXJnaW46ICcxcHgnLFxuICAgICAgICAgICAgcGFkZGluZzogJzBweCcsXG4gICAgICAgICAgICBvcGFjaXR5OiAnMC4zJ1xuXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb250ZXh0TWVudS5hcHBlbmRBc0xpc3QoY29udGV4dEFycmF5KTtcblxuICAgIHRoaXMuU3ltYm9sU3RvcmUucmVnaXN0ZXIoJ0NvbnRleHRJY29uJywgZnVuY3Rpb24gKHBvc3gsIHBvc3ksIHJhZCkge1xuICAgICAgdmFyIHggPSBwb3N4LFxuICAgICAgICB5ID0gcG9zeSxcbiAgICAgICAgciA9IHJhZCAqIDIsXG4gICAgICAgIHNwYWNlID0gTWF0aC5yb3VuZChyIC8gNCksXG4gICAgICAgIGhhbGZXaWR0aCA9IE1hdGgucm91bmQociAvIDIpICogMC43LFxuICAgICAgICBzdGFydFggPSAoeCAtIGhhbGZXaWR0aCksXG4gICAgICAgIGVuZFggPSAoeCArIGhhbGZXaWR0aCksXG4gICAgICAgIHN0YXJ0WSA9ICh5ICsgc3BhY2UpLFxuICAgICAgICBlbmRZID0gKHkgLSBzcGFjZSk7XG4gICAgICByZXR1cm4gWydNJywgc3RhcnRYLCB5LCAnTCcsIGVuZFgsIHksICdNJywgc3RhcnRYLCBzdGFydFksICdMJywgZW5kWCwgc3RhcnRZLCAnTScsIHN0YXJ0WCwgZW5kWSwgJ0wnLCBlbmRYLCBlbmRZXTtcbiAgICB9KTtcblxuICAgIC8vIHRoaXMuU3ltYm9sU3RvcmUucmVnaXN0ZXIoJ3RleHRCb3hJY29uJywgZnVuY3Rpb24gKHgsIHksIHJhZCwgdywgaCwgcGFkWCwgcGFkWSkge1xuICAgIC8vICAgdmFyIHgxID0geCAtIHcgLyAyICsgcGFkWCAvIDIsXG4gICAgLy8gICAgIHgyID0geCArIHcgLyAyIC0gcGFkWCAvIDIsXG4gICAgLy8gICAgIHkxID0geSAtIGggLyAyICsgcGFkWSAvIDIsXG4gICAgLy8gICAgIHkyID0geSArIGggLyAyIC0gcGFkWSAvIDI7XG5cbiAgICAvLyAgIHJldHVybiBbJ00nLCB4MSwgeTEsICdMJywgeDIsIHkxLCAnTCcsIHgyLCB5MiwgJ0wnLCB4MSwgeTIsICdaJ107XG4gICAgLy8gfSk7XG5cbiAgICAvLyBncm91cC5hZGRTeW1ib2woc2VsZWN0TWVudSk7XG4gICAgLy8gZ3JvdXAuYWRkU3ltYm9sKHJlc2V0QnV0dG9uKTtcbiAgICBncm91cC5hZGRTeW1ib2woY29udGV4dE1lbnUpO1xuICAgIHRvb2xiYXIuYWRkQ29tcG9uZW50KGdyb3VwKTtcbiAgICByZXR1cm4gdG9vbGJhcjtcbiAgfTtcblxuICBMZWdlbmRFeHQucHJvdG90eXBlLmdldExvZ2ljYWxTcGFjZSA9IGZ1bmN0aW9uIChhdmFpbGFibGVXaWR0aCwgYXZhaWxhYmxlSGVpZ2h0KSB7XG4gICAgYXZhaWxhYmxlV2lkdGggLz0gMjtcbiAgICB2YXIgbG9naWNhbFNwYWNlLFxuICAgICAgd2lkdGggPSAwLFxuICAgICAgaGVpZ2h0ID0gMCxcbiAgICAgIGksXG4gICAgICBsbjtcblxuICAgIGZvciAoaSA9IDAsIGxuID0gdGhpcy50b29sYmFycy5sZW5ndGg7IGkgPCBsbjsgaSsrKSB7XG4gICAgICBsb2dpY2FsU3BhY2UgPSB0aGlzLnRvb2xiYXJzW2ldLmdldExvZ2ljYWxTcGFjZShhdmFpbGFibGVXaWR0aCwgYXZhaWxhYmxlSGVpZ2h0KTtcbiAgICAgIHdpZHRoID0gTWF0aC5tYXgobG9naWNhbFNwYWNlLndpZHRoLCB3aWR0aCk7XG4gICAgICBoZWlnaHQgKz0gbG9naWNhbFNwYWNlLmhlaWdodDtcbiAgICAgIHRoaXMudG9vbGJhcnNbaV0ud2lkdGggPSBsb2dpY2FsU3BhY2Uud2lkdGg7XG4gICAgICB0aGlzLnRvb2xiYXJzW2ldLmhlaWdodCA9IGxvZ2ljYWxTcGFjZS5oZWlnaHQ7XG4gICAgfVxuICAgIGhlaWdodCArPSB0aGlzLnBhZGRpbmc7XG4gICAgcmV0dXJuIHtcbiAgICAgIHdpZHRoOiB3aWR0aCA+IGF2YWlsYWJsZVdpZHRoID8gMCA6IHdpZHRoLFxuICAgICAgaGVpZ2h0OiBoZWlnaHQgPiBhdmFpbGFibGVIZWlnaHQgPyAwIDogaGVpZ2h0XG4gICAgfTtcbiAgfTtcblxuICBMZWdlbmRFeHQucHJvdG90eXBlLnBsYWNlSW5DYW52YXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHNlbGYucGFkZGluZyA9IDU7XG4gICAgc2VsZi5zcGFjZU1hbmFnZXJJbnN0YW5jZS5hZGQoW3tcbiAgICAgIG5hbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICdUb29sQm94RXh0JztcbiAgICAgIH0sXG4gICAgICByZWY6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgcmV0dXJuIG9ialsnMCddO1xuICAgICAgfSxcbiAgICAgIHNlbGY6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHNlbGY7XG4gICAgICB9LFxuICAgICAgcHJpb3JpdHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIDI7XG4gICAgICB9LFxuICAgICAgbGF5b3V0OiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIHJldHVybiBvYmouaW5saW5lO1xuICAgICAgfSxcbiAgICAgIG9yaWVudGF0aW9uOiBbe1xuICAgICAgICB0eXBlOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgcmV0dXJuIG9iai5ob3Jpem9udGFsO1xuICAgICAgICB9LFxuICAgICAgICBwb3NpdGlvbjogW3tcbiAgICAgICAgICB0eXBlOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICByZXR1cm4gb2JqLnRvcDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFsaWdubWVudDogW3tcbiAgICAgICAgICAgIHR5cGU6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG9iai5yaWdodDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaW1lbnNpb25zOiBbZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5nZXRQYXJlbnRDb21wb25lbnRHcm91cCgpO1xuICAgICAgICAgICAgICByZXR1cm4gc2VsZi5nZXRMb2dpY2FsU3BhY2UocGFyZW50LmdldFdpZHRoKCksIHBhcmVudC5nZXRIZWlnaHQoKSk7XG4gICAgICAgICAgICB9XVxuICAgICAgICAgIH1dXG4gICAgICAgIH1dXG4gICAgICB9XVxuICAgIH1dKTtcbiAgfTtcblxuICBMZWdlbmRFeHQucHJvdG90eXBlLnNldERyYXdpbmdDb25maWd1cmF0aW9uID0gZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQsIGdyb3VwKSB7XG4gICAgdmFyIG1lcyA9IHRoaXMubWVhc3VyZW1lbnQ7XG4gICAgbWVzLnggPSB4O1xuICAgIG1lcy55ID0geTtcbiAgICBtZXMud2lkdGggPSB3aWR0aDtcbiAgICBtZXMuaGVpZ2h0ID0gaGVpZ2h0O1xuXG4gICAgdGhpcy5wYXJlbnRHcm91cCA9IGdyb3VwO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgTGVnZW5kRXh0LnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQsIGdyb3VwKSB7XG4gICAgdmFyIG1lYXN1cmVtZW50ID0gdGhpcy5tZWFzdXJlbWVudCxcbiAgICAgIHRvb2xiYXJzID0gdGhpcy50b29sYmFycyxcbiAgICAgIGxuLFxuICAgICAgaSxcbiAgICAgIHRvb2xiYXI7XG4gICAgeCA9IHggPT09IHVuZGVmaW5lZCA/IG1lYXN1cmVtZW50LnggOiB4O1xuICAgIHkgPSB5ID09PSB1bmRlZmluZWQgPyBtZWFzdXJlbWVudC55IDogeTtcbiAgICB3aWR0aCA9IHdpZHRoID09PSB1bmRlZmluZWQgPyBtZWFzdXJlbWVudC53aWR0aCA6IHdpZHRoO1xuICAgIGhlaWdodCA9IGhlaWdodCA9PT0gdW5kZWZpbmVkID8gbWVhc3VyZW1lbnQuaGVpZ2h0IDogaGVpZ2h0O1xuICAgIGdyb3VwID0gZ3JvdXAgPT09IHVuZGVmaW5lZCA/IHRoaXMucGFyZW50R3JvdXAgOiBncm91cDtcbiAgICBpZiAod2lkdGggJiYgaGVpZ2h0KSB7XG4gICAgICBmb3IgKGkgPSAwLCBsbiA9IHRvb2xiYXJzLmxlbmd0aDsgaSA8IGxuOyBpKyspIHtcbiAgICAgICAgdG9vbGJhciA9IHRvb2xiYXJzW2ldO1xuICAgICAgICB0b29sYmFyLmRyYXcoeCwgeSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIEZ1c2lvbkNoYXJ0cy5yZWdpc3RlckNvbXBvbmVudCgnZXh0ZW5zaW9ucycsICdsZWdlbmRFeHQnLCBMZWdlbmRFeHQpO1xufV0pO1xuXG4ndXNlIHN0cmljdCc7XG5jbGFzcyBHcm93dGhBbmFseXNlciB7XG4gIGNvbnN0cnVjdG9yIChkYXRhKSB7XG4gICAgdGhpcy5kYXRhID0gZGF0YS5tYXAoKGEpID0+IHtcbiAgICAgIHJldHVybiBhLm1hcCgoYikgPT4geyByZXR1cm4gYjsgfSk7XG4gICAgfSk7XG4gICAgdGhpcy5Gb3JtdWxhZSA9IEZvcm11bGFlO1xuICB9XG4gIGFuYWx5c2UgKG1vZGUpIHtcbiAgICBsZXQgaSA9IDAsXG4gICAgICBpaSA9IDAsXG4gICAgICBqID0gMCxcbiAgICAgIGpqID0gMCxcbiAgICAgIG51bSA9IDAsXG4gICAgICBjaGVja0FyciA9IFtdLFxuICAgICAgY2hlY2tOdW0gPSAwLFxuICAgICAgZGF0YUFyID0gdGhpcy5kYXRhLFxuICAgICAgbkRhdGFBciA9IFtdLFxuICAgICAgdGVtcEFyID0gW107XG4gICAgaWYgKCFpc05hTihtb2RlKSkgeyAvLyBIYW5kbGluZyBhIG51bWJlclxuICAgICAgY2hlY2tOdW0gPSArbW9kZTtcbiAgICAgIGZvciAoaSA9IDAsIGlpID0gZGF0YUFyLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgdGVtcEFyID0gW107XG4gICAgICAgIGZvciAoaiA9IDAsIGpqID0gZGF0YUFyW2ldLmxlbmd0aDsgaiA8IGpqOyArK2opIHtcbiAgICAgICAgICBudW0gPSBkYXRhQXJbaV1bal07XG4gICAgICAgICAgdGVtcEFyLnB1c2goMTAwICogKG51bSAtIGNoZWNrTnVtKSAvIGNoZWNrTnVtKTtcbiAgICAgICAgfVxuICAgICAgICBuRGF0YUFyLnB1c2godGVtcEFyKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBtb2RlID09PSAnc3RyaW5nJykge1xuICAgICAgbW9kZSA9IHRoaXMuRm9ybXVsYWVbbW9kZV07XG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGRhdGFBci5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIHRlbXBBciA9IFtdO1xuICAgICAgICBjaGVja051bSA9IG1vZGUoZGF0YUFyW2ldKTtcbiAgICAgICAgZm9yIChqID0gMCwgamogPSBkYXRhQXJbaV0ubGVuZ3RoOyBqIDwgamo7ICsraikge1xuICAgICAgICAgIG51bSA9IGRhdGFBcltpXVtqXTtcbiAgICAgICAgICB0ZW1wQXIucHVzaCgxMDAgKiAobnVtIC0gY2hlY2tOdW0pIC8gY2hlY2tOdW0pO1xuICAgICAgICB9XG4gICAgICAgIG5EYXRhQXIucHVzaCh0ZW1wQXIpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoIWlzTmFOKG1vZGUucmVscG9zaXRpb24pKSB7XG4gICAgICBtb2RlID0gbW9kZS5yZWxwb3NpdGlvbjtcbiAgICAgIGZvciAoaSA9IDAsIGlpID0gZGF0YUFyLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgICAgdGVtcEFyID0gW107XG4gICAgICAgIGZvciAoaiA9IDAsIGpqID0gZGF0YUFyW2ldLmxlbmd0aDsgaiA8IGpqOyArK2opIHtcbiAgICAgICAgICBudW0gPSBkYXRhQXJbaV1bal07XG4gICAgICAgICAgaWYgKGogKyBtb2RlID49IDAgJiYgaiArIG1vZGUgPCBqaikge1xuICAgICAgICAgICAgY2hlY2tOdW0gPSBkYXRhQXJbaV1baiArIG1vZGVdO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjaGVja051bSA9IG51bTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGVtcEFyLnB1c2goMTAwICogKG51bSAtIGNoZWNrTnVtKSAvIGNoZWNrTnVtKTtcbiAgICAgICAgfVxuICAgICAgICBuRGF0YUFyLnB1c2godGVtcEFyKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFpc05hTihtb2RlLnBvc2l0aW9uKSkge1xuICAgICAgbW9kZSA9IG1vZGUucG9zaXRpb247XG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGRhdGFBci5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIHRlbXBBciA9IFtdO1xuICAgICAgICBmb3IgKGogPSAwLCBqaiA9IGRhdGFBcltpXS5sZW5ndGg7IGogPCBqajsgKytqKSB7XG4gICAgICAgICAgbnVtID0gZGF0YUFyW2ldW2pdO1xuICAgICAgICAgIGlmIChtb2RlID49IDAgJiYgbW9kZSA8IGpqKSB7XG4gICAgICAgICAgICBjaGVja051bSA9IGRhdGFBcltpXVttb2RlXTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2hlY2tOdW0gPSBudW07XG4gICAgICAgICAgfVxuICAgICAgICAgIHRlbXBBci5wdXNoKDEwMCAqIChudW0gLSBjaGVja051bSkgLyBjaGVja051bSk7XG4gICAgICAgIH1cbiAgICAgICAgbkRhdGFBci5wdXNoKHRlbXBBcik7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghaXNOYU4obW9kZS5yZWxkYXRhc2V0cG9zaXRpb24pKSB7XG4gICAgICBtb2RlID0gbW9kZS5yZWxkYXRhc2V0cG9zaXRpb247XG4gICAgICBmb3IgKGkgPSAwLCBpaSA9IGRhdGFBci5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICAgIHRlbXBBciA9IFtdO1xuICAgICAgICBpZiAoaSArIG1vZGUgPj0gMCAmJiBpICsgbW9kZSA8IGlpKSB7XG4gICAgICAgICAgY2hlY2tBcnIgPSBkYXRhQXJbaSArIG1vZGVdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNoZWNrQXJyID0gZGF0YUFyW2ldO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoaiA9IDAsIGpqID0gZGF0YUFyW2ldLmxlbmd0aDsgaiA8IGpqOyArK2opIHtcbiAgICAgICAgICBjaGVja051bSA9IGNoZWNrQXJyW2pdO1xuICAgICAgICAgIG51bSA9IGRhdGFBcltpXVtqXTtcbiAgICAgICAgICB0ZW1wQXIucHVzaCgxMDAgKiAobnVtIC0gY2hlY2tOdW0pIC8gbnVtKTtcbiAgICAgICAgfVxuICAgICAgICBuRGF0YUFyLnB1c2godGVtcEFyKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZm9yIChpID0gMCwgaWkgPSBuRGF0YUFyLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcbiAgICAgIGZvciAoaiA9IDAsIGpqID0gbkRhdGFBcltpXS5sZW5ndGg7IGogPCBqajsgKytqKSB7XG4gICAgICAgIGlmICghTnVtYmVyLmlzRmluaXRlKG5EYXRhQXJbaV1bal0pKSB7XG4gICAgICAgICAgbkRhdGFBcltpXVtqXSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5EYXRhQXI7XG4gIH1cbn1cblxudmFyIEZvcm11bGFlID0ge1xuICBtaW46IChhcnIpID0+IHtcbiAgICByZXR1cm4gYXJyLnJlZHVjZSgoYSwgYikgPT4ge1xuICAgICAgcmV0dXJuIGEgPiBiID8gYiA6IGE7XG4gICAgfSk7XG4gIH0sXG4gIG1heDogKGFycikgPT4ge1xuICAgIHJldHVybiBhcnIucmVkdWNlKChhLCBiKSA9PiB7XG4gICAgICByZXR1cm4gYSA8IGIgPyBiIDogYTtcbiAgICB9KTtcbiAgfSxcbiAgbWVhbjogKGFycikgPT4ge1xuICAgIHJldHVybiBhcnIucmVkdWNlKChhLCBiKSA9PiB7XG4gICAgICByZXR1cm4gYSArIGI7XG4gICAgfSkgLyBhcnIubGVuZ3RoO1xuICB9LFxuICBtZWRpYW46IChhcnIpID0+IHtcbiAgICByZXR1cm4gYXJyLm1hcCgoYSkgPT4gYSkuc29ydCgoYSwgYikgPT4geyByZXR1cm4gYSAtIGI7IH0pW2Fyci5sZW5ndGggLyAyXTtcbiAgfSxcbiAgc2Q6ICh2YWx1ZXMpID0+IHtcbiAgICBmdW5jdGlvbiBhdmVyYWdlIChkYXRhKSB7XG4gICAgICB2YXIgc3VtLCBhdmc7XG4gICAgICBzdW0gPSBkYXRhLnJlZHVjZShmdW5jdGlvbiAoc3VtLCB2YWx1ZSkge1xuICAgICAgICByZXR1cm4gc3VtICsgdmFsdWU7XG4gICAgICB9LCAwKTtcblxuICAgICAgYXZnID0gc3VtIC8gZGF0YS5sZW5ndGg7XG4gICAgICByZXR1cm4gYXZnO1xuICAgIH1cbiAgICB2YXIgYXZnID0gMCxcbiAgICAgIHNxdWFyZURpZmZzID0gMCxcbiAgICAgIHNxckRpZmYgPSAwLFxuICAgICAgYXZnU3F1YXJlRGlmZiA9IDAsXG4gICAgICBzdGREZXYgPSAwLFxuICAgICAgZGlmZiA9IDA7XG4gICAgYXZnID0gYXZlcmFnZSh2YWx1ZXMpO1xuICAgIHNxdWFyZURpZmZzID0gdmFsdWVzLm1hcChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIGRpZmYgPSB2YWx1ZSAtIGF2ZztcbiAgICAgIHNxckRpZmYgPSBkaWZmICogZGlmZjtcbiAgICAgIHJldHVybiBzcXJEaWZmO1xuICAgIH0pO1xuICAgIGF2Z1NxdWFyZURpZmYgPSBhdmVyYWdlKHNxdWFyZURpZmZzKTtcbiAgICBzdGREZXYgPSBNYXRoLnNxcnQoYXZnU3F1YXJlRGlmZik7XG4gICAgcmV0dXJuIHN0ZERldjtcbiAgfVxufTtcbn0odGhpcywgZG9jdW1lbnQpKTtcbiJdLCJmaWxlIjoiZ3Jvd3RoLWFuYWx5c2VyLWVzNi5taW4uanMifQ==
